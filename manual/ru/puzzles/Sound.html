<!DOCTYPE html>
<html lang="ru">
  <head>
    <title>Аудио и видео пазлы (Audio/Video) — Софт Эйт Софт</title>
    <meta charset="utf-8">
    <meta name="description" content="Как загружать, воспроизводить и управлять аудио и видео с помощью пазлов Вердж3Д.">
    <base href="../../../">
    <script src="page.js"></script>
    <link type="text/css" rel="stylesheet" href="page.css">
  </head>
  <body><article>
    <h1>Аудио и видео пазлы (Audio/Video)</h1>

    <p>
      Эти пазлы используются для загрузки и воспроизведения аудио и видеофайлов, а также для синтеза и воспроизведения MIDI-звуков.
    </p>

    <img src="files/puzzles/puzzles-sound.jpg">


    <h2>Содержание</h2>

    [contents]


    [anchor:puzzles_reference]

    <h2>Перечень пазлов</h2>


    [anchor:load_sound]

    <h3>load sound</h3>

    <p>
      Загружает аудиофайл по указанному <a href="manual/ru/puzzles/HTML.html#url_paths">УРЛ-адресу</a>. Аудио воспроизводится с помощью WebAudio API или HTML-элемента `&lt;audio&gt;` в зависимости от выбранного типа: *sound*/*midi* или *music* соответственно. Этот пазл также добавляет загруженное аудио в кэш, так что при последующем использовании этого пазла с тем же УРЛ-адресом звуковой файл не требует повторной загрузки. Мы рекомендуем использовать формат <strong>.mp3</strong>, так как он поддерживается большинством веб-браузеров.
    </p>

    <img src="files/puzzles/puzzles-sound-load-sound.webp">

    [demo:farmers_journey Приключения фермера]

    <h4 id="load_sound_preloading">предзагрузка аудио</h4>

    <p>
      Загрузка аудиофайлов занимает некоторое время, поэтому они доступны не сразу. Простое использование этого пазла внутри пазла <a href="manual/ru/puzzles/Sound.html#play">play</a> может не сработать и звук может не воспроизводиться.
    </p>
    <p>
      Чтобы быть уверенным в том, что звук в вашем приложении работает правильно, рекомендуется загружать звуковые файлы заранее, например, во вкладке <a href="manual/ru/introduction/Puzzles-Visual-Logic-Editor.html#Tabs">инициализации</a>, которая выполняется перед инициализацией приложения «Вердж3Д». Вы также можете использовать пазл <a href="manual/ru/puzzles/Advanced.html#connector">connector</a>, чтобы организовать группу пазлов "load sound" более удобным способом:
    </p>

    <figure>
      <img src="files/puzzles/puzzles-sound-preload-init.webp">
      <figcaption>Предварительная загрузка аудио во вкладке инициализации.</figcaption>
    </figure>

    <p>
      После этого использование предварительно загруженных аудиофайлов в <a href="manual/ru/introduction/Puzzles-Visual-Logic-Editor.html#Tabs">главной</a> (исходное название "New Tab") или созданной пользователем вкладке не вызовет никаких проблем. Поскольку звук кэшируется после первого использования пазла "load sound", его не нужно загружать снова:
    </p>

    <figure>
      <img src="files/puzzles/puzzles-sound-preload-usage.webp">
      <figcaption>Использование предварительно загруженного аудио на главной вкладке.</figcaption>
    </figure>

    <h4>ограничения автоматического воспроизведения</h4>

    <p>
      В целом, запущенное программно воспроизведение (как в случае с пазлами), скорее всего, будет заблокировано браузером. Это происходит из-за политики автовоспроизведения, которая ограничивает автоматическое воспроизведение аудио на веб-странице. Цель таких ограничений — не дать веб-страницам издавать спонтанные звуки или воспроизводить аудио, когда это нежелательно.
    </p>
    <p>
      Хотя такая политика может быть реализована по-разному в различных браузерах, а также может иметь различные условия для разрешения/неразрешения автовоспроизведения, общее правило для воспроизведения аудио — ждать, пока пользователь взаимодействует с вашей веб-страницей.
    </p>
    <p>
      Ограничения не накладываются, когда такое взаимодействие уже подразумевается логикой приложения, например, воспроизведение звука при нажатии (будь то 3Д-объект или HTML-кнопка). Допустим, вы хотите, чтобы в вашем приложении была фоновая музыка, которая начинала бы играть при загрузке приложения. Поскольку это не всегда можно сделать автоматически, хорошим решением будет сделать кнопку "Старт" для запуска приложения, когда оно загружено и готово. Нажатие на нее считается взаимодействием с пользователем и позволяет запустить воспроизведение аудио.
    </p>

    <h4>Типы аудио "music", "sound", "midi"</h4>

    <p>
      Пазл позволяет выбрать, какой API использовать для загрузки и воспроизведения аудиофайлов.
    </p>

    <img src="files/puzzles/puzzles-sound-load-sound-type.webp">

    <dl>
      <dt>sound (по умолчанию)</dt>
      <dd>
        Лучше подходит для коротких аудиофайлов, например звуковых эффектов; рекомендуется использовать этот тип только в следующих случаях:
        <ul>
          <li>
            Короткие, зацикленные (см. пазл <a href="manual/ru/puzzles/Sound.html#play">play</a> и его опцию *loop*) звуковые эффекты — "sound" делает зацикленное аудио бесшовным, в то время как с "music" у вас есть заметная задержка;
          </li>
          <li>
            Звуковые эффекты, которые должны воспроизводиться немедленно, например, при взаимодействии с пользователем, в «Сафари» воспроизведение идёт с задержкой — "sound" устраняет эту проблему.
          </li>
        </ul>
      </dd>

      <dt>music</dt>
      <dd>
        Следует использовать в остальных случаях; лучше подходит для длинных аудиофайлов, например, фоновой музыки.
      </dd>

      <dt>midi</dt>
      <dd>
        Особый тип *sound*, который используется для воспроизведения стандартных MIDI-файлов (с расширением <strong>*.mid</strong>). По сравнению с музыкой, хранящейся в <strong>*.mp3</strong>, MIDI-файлы действительно легкие и оказывают минимальное влияние на время загрузки приложения. Обратная сторона использования MIDI — несколько сниженное качество звуковой дорожки.
      </dd>
    </dl>


    [anchor:load_video]

    <h3>load video</h3>

    <p>
      Создает HTML-элемент `&lt;video&gt;` и загружает видеофайл по указанному <a href="manual/ru/puzzles/HTML.html#url_paths">УРЛ-адресу</a>. Этот пазл также добавляет созданный видеоэлемент в кэш памяти, чтобы при последующем использовании этого пазла с тем же УРЛ не загружать тот же звуковой файл снова. Рекомендуется использовать формат <strong>.mp4</strong>, поскольку он поддерживается большинством веб-браузеров.
    </p>

    <img src="files/puzzles/puzzles-sound-load-video.jpg">

    <p>
      Пазл *load video* не создает никаких видимых элементов на сцене. Чтобы сделать его видимым, назначьте видео как текстуру материала с помощью пазла <a href="manual/ru/puzzles/Materials.html#replace_texture">replace texture</a>.
    </p>

    [demo:video_texture]


    [anchor:play]

    <h3>play</h3>

    <p>
      Запускает воспроизведение аудио или видео. Параметр *loop* служит для зацикливания воспроизведения.
    </p>

    <img src="files/puzzles/puzzles-sound-play.webp">

    <p>
      Из-за ограничений браузера (не позволяющих вредоносным веб-сайтам воспроизводить шумные звуки и видео) вы не должны выполнять этот пазл для автоматического воспроизведения ваших ассетов (при загрузке сцены). Вместо этого, вы должны сделать это в каком-либо пользовательском событии. Используйте <a href="manual/ru/puzzles/Events.html#when_clicked">when clicked</a> или <a href="manual/ru/puzzles/HTML.html#event">event</a> для обработки таких событий.
    </p>
    <p class="note">
      Из этого правила есть одно исключение. Браузеры позволяют автоматически воспроизводить видео с выключенным звуком. См. пазл <a href="manual/ru/puzzles/Sound.html#mute">mute</a>.
    </p>


    [anchor:pause]

    <h3>pause</h3>

    <p>
      Приостанавливает воспроизведение аудио или видео.
    </p>

    <img src="files/puzzles/puzzles-sound-pause.webp">

    [anchor:stop]

    <h3>stop</h3>

    <p>
      Останавливает воспроизведение аудио или видео. Использование этого пазла эквивалентно использованию пазла <a href="manual/ru/puzzles/Sound.html#pause">pause</a>, а за ним пазла <a href="manual/ru/puzzles/Sound.html#rewind">rewind</a>.
    </p>

    <img src="files/puzzles/puzzles-sound-stop.webp">


    [anchor:rewind]

    <h3>rewind</h3>

    <p>
      Заставляет аудио или видео ресурс воспроизводиться с самого начала.
    </p>

    <img src="files/puzzles/puzzles-sound-rewind.webp">


    [anchor:set_playback_time]

    <h3>set playback time</h3>

    <p>
      Установка текущего времени воспроизведения аудио/видео в секундах.
    </p>

    <img src="files/puzzles/puzzles-sound-set-playback-time.jpg">

    <p class="note">
      Установка времени воспроизведения не поддерживается для ассетов *sound* (WebAudio).
    </p>


    [anchor:get_playback_time]

    <h3>get playback time</h3>

    <p>
      Получение текущего места воспроизведения аудио/видео в секундах.
    </p>

    <img src="files/puzzles/puzzles-sound-get-playback-time.jpg">

    <p class="note">
      Получение времени воспроизведения не поддерживается для ассетов *sound* (WebAudio).
    </p>


    [anchor:get_duration]

    <h3>get duration</h3>

    <p>
      Возвращает длительность аудио/видео ресурса в секундах.
    </p>

    <img src="files/puzzles/puzzles-sound-get-duration.jpg">


    [anchor:set_playback_rate]

    <h3>set playback rate</h3>

    <p>
      Устанавливает скорость воспроизведения аудио/видео. Укажите значение `&lt;1` для замедления воспроизведения, `1` для нормальной скорости и `&gt;1` для увеличения скорости воспроизведения.
    </p>

    <img src="files/puzzles/puzzles-sound-set-playback-rate.jpg">

    <p class="note">
      Установка скорости воспроизведения не поддерживается для ассетов *midi*.
    </p>


    [anchor:is_playing]

    <h3>is playing</h3>

    <p>
      Проверяет, воспроизводится ли звук или видео.
    </p>

    <img src="files/puzzles/puzzles-sound-is-playing.webp">


    [anchor:set_volume]

    <h3>set volume</h3>

    <p>
      Устанавливает громкость звука. Входная громкость устанавливается в диапазоне 0,0-1,0. Этот пазл также работает для видео со встроенной звуковой дорожкой.
    </p>

    <img src="files/puzzles/puzzles-sound-set-volume.webp">


    [anchor:mute]

    <h3>mute</h3>

    <p>
      Делает воспроизведение аудио или видео ресурса беззвучным.
    </p>
    <p>
      Помимо управления громкостью звука, вы можете использовать этот пазл для автоматического запуска воспроизведения видео. Это возможно, поскольку веб-браузеры позволяют воспроизводить видео с выключенным звуком без участия пользователя.
    </p>

    <img src="files/puzzles/puzzles-sound-mute.jpg" style="max-width: 557px">


    [anchor:unmute]

    <h3>unmute</h3>

    <p>
      Включает звук при воспроизведении аудио или видео ресурса.
    </p>

    <img src="files/puzzles/puzzles-sound-unmute.jpg" style="max-width: 511px">


    [anchor:positional_speaker]

    <h3>positional speaker</h3>

    <p>
      Делает звуковой ресурс позиционным, посредством прикрепления его к указанному 3Д-объекту.
    </p>

    <img src="files/puzzles/puzzles-sound-positional-speaker.webp">

    <p>
      Ресурсы типа <em>sound</em> и <em>music</em> могут быть превращены в позиционные источники. Для настройки воспроизведения таких источников используются параметры *rolloff from* – дистанция с которой начнётся уменьшение громкости звука и *factor* – интенсивность уменьшения с расстоянием.
    </p>


    [anchor:synth_sound]

    <h3>synth sound</h3>

    <p>
      Воспроизведение звука с помощью встроенного <em>General MIDI</em>-совместимого программного синтезатора (на основе <a href="https://github.com/g200kg/webaudio-tinysynth" target="_blank">библиотеки TinySynth</a>). Поддерживаются различные инструменты и эффекты.
    </p>

    <img src="files/puzzles/puzzles-sound-synth-sound.jpg">

    <dl>
      <dt>note on</dt>
      <dd>Начать воспроизведение *note* (ноты) с помощью заданного *channel* (канала) синтезатора с интенсивностью звука, указанной как *velocity* (скорость) (0-127). Используйте значение *at time* для указания времени начала воспроизведения в секундах.</dd>

      <dt>note off</dt>
      <dd>Останавливает воспроизведение заданной *note* (ноты).</dd>

      <dt>set instrument</dt>
      <dd>Установить инструмент канала из заданного списка.</dd>

      <dt>set volume</dt>
      <dd>Установить громкость канала.</dd>

      <dt>set pan</dt>
      <dd>Установить уровень pan канала.</dd>

      <dt>stop sounds</dt>
      <dd>Остановить все звуки в выбранном канале.</dd>
    </dl>

    <p>
      Чтобы воспроизвести ударные, укажите *Drums* в качестве номера канала и используйте <a href="manual/ru/puzzles/Sound.html#get_drum_number">drum number</a> для выбора инструмента.
    </p>

    <p>Пример</p>

    <img src="files/puzzles/puzzles-sound-synth-sound-example.jpg">


    [anchor:get_note_number]

    <h3>note number</h3>

    <p>
      Задает номер ноты. Используется для передачи нот в канал *1*-*9* пазла <a href="manual/ru/puzzles/Sound.html#synth_sound">synth sound</a>.
    </p>

    <img src="files/puzzles/puzzles-sound-get-note-number.jpg">

    <p>
      Номера октав указываются с помощью <a href="https://ru.wikipedia.org/wiki/%D0%90%D0%BC%D0%B5%D1%80%D0%B8%D0%BA%D0%B0%D0%BD%D1%81%D0%BA%D0%B0%D1%8F_%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D0%B0_%D0%BD%D0%BE%D1%82%D0%B0%D1%86%D0%B8%D0%B8" target="_blank">американской системы нотации</a>, например, <em>C 4</em> означает <em>До первой октавы</em>.
    </p>


    [anchor:get_drum_number]

    <h3>drum number</h3>

    <p>
      Задает номер ударных. Используйте его для передачи нот в канал *Drums* пазла <a href="manual/ru/puzzles/Sound.html#synth_sound">synth sound</a>.
    </p>

    <img src="files/puzzles/puzzles-sound-get-drum-number.jpg">


    <h2>Проблемы с пазлами?</h2>

    <p>Обращайтесь за помощью на наш <a href="https://www.soft8soft.com/ru/форумы/" target="_blank">форум</a>!</p>

  </article></body>
</html>
