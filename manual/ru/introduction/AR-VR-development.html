<!DOCTYPE html>
<html lang="ru">
  <head>
    <title>Разработка приложений виртуальной и дополненной реальности — Софт Эйт Софт</title>
    <meta charset="utf-8">
    <meta name="description" content="Узнайте, как добавлять функции дополненной и виртуальной реальности в приложения Вердж3Д.">
    <base href="../../../">
    <script src="page.js"></script>
    <link type="text/css" rel="stylesheet" href="page.css">
  </head>
  <body><article>

    <h1>Разработка приложений виртуальной и дополненной реальности</h1>

    <p>
      «Вердж3Д» позволяет создавать приложения для дополненной реальности (ДР) и виртуальной реальности (ВР) на основе браузерной технологии WebXR (расшифровывается как «расширенная реальность для веба»). Кроме того, вы можете использовать формат USDZ и технологию «Эпл АР Квик Лук» чтобы показывать ваши модели в режиме дополненной реальности на устройствах «Айфон» и «Айпад».
</p>

    <h2>Содержание</h2>

    [contents]


    [anchor:virtual_reality]

    <h2>Виртуальная реальность (ВР)</h2>


    [anchor:Setting_up_VR]

    <h3>Настройки</h3>

    <p>
      Устройства «Эйч-Ти-Си Вайв» и «Мета Квест» поддерживаются технологией WebXR и должны работать из коробки. Для устройств подключаемых к компьютеру, типа «Эйч-Ти-Си Вайв про» вам потребуется браузер «Гугл Хром» (или подобный). Для мобильных устройств виртуальной реальности, типа «Мета Квест», используйте встроенный браузер.
    </p>

    <p class="note">
      WebXR требует безопасного контекста. Приложения «Вердж3Д» должны обслуживаться через HTTPS или с УРЛ-адреса localhost.
    </p>


    [anchor:Creating_VR_Apps]

    <h3>Создание ВР-приложений</h3>

    <p>
      Наличие ВР-режима проверяется с помощью пазла <a href="manual/ru/puzzles/AR_VR.html#check_vr_mode">check VR mode</a>, а вход в ВР-режим осуществляется с помощью пазла <a href="manual/ru/puzzles/AR_VR.html#enter_vr_mode">enter VR mode</a>.
    </p>

    <img src="files/ar-vr-development/minimal-vr-puzzles.jpg" alt="Минимальные ВР-пазлы">

    <p>Для ВР-устройств <i>без контроллеров</i> взаимодействие с 3Д-объектами осуществляется с помощью прицельного указателя.</p>

    <img src="files/ar-vr-development/gaze-based-reticle-pointer.jpg" alt="Прицельный указатель в ВР">

    <p>
      Для ВР-устройств <i>с контроллерами</i> взаимодействие осуществляется с помощью виртуального луча, исходящего из контроллеров.
    </p>

    <img src="files/ar-vr-development/google-daydream-vr-controller.jpg" alt="Лучевой указатель в ВР">

    <p>
      Вы можете использовать стандартные пазлы <a href="manual/ru/puzzles/Events.html#when_hovered">when hovered</a> или <a href="manual/ru/puzzles/Events.html#when_clicked">when clicked</a> для захвата пользовательских действий, а также специфические для ВР события перехватываемые с помощью пазла <a href="manual/ru/puzzles/AR_VR.html#session_event">on session event</a>.
    </p>


    [anchor:how_to_move_in_vr_mode]

    <h3>Перемещение в виртуальной реальности</h3>

    <p>
      При активации режима виртуальной реальности создаётся специальная стерео-камера, привязанная к устройству. Это означает, что штатные пазлы и режимы управления камерой, назначенные в 3Д-пакетах не работают. Вместо них необходимо привязать камеру в некоему объекту (выполняющему функцию персонажа) и перемещать этот объект. Смотрите описание пазла <a href="manual/ru/puzzles/AR_VR.html#xr_camera_control_object">camera control object</a> чтобы получить больше информации.
    </p>

    <p>
      В целом, вам потребуется реализовать свою собственную логику перемещения персонажа, в частности использовать физику чтобы ограничить его перемещения за пределами сцены. Однако для режима позиционирования камеры *sitting or standing* мы сделали библиотеку <a href="manual/ru/puzzles/Library.html#vr_controls">VR Controls</a>, которая уже включает в себя всю необходимую функциональность.
    </p>

    [demo:virtual_reality Виртуальная реальность]



    [anchor:augmented_reality]

    <h2>Дополненная реальность (ДР)</h2>


    [anchor:Setting_up_AR]

    <h3>Настройки</h3>

    <p>Вы можете запускать свои приложения дополненной реальности на базе «Вердж3Д» на мобильных устройствах с операционными системами «Андроид» и «Ай ОС»/«Айпад ОС».</p>

    <p class="note">
      WebXR требует безопасного контекста. Приложения «Вердж3Д» должны обслуживаться через HTTPS или с УРЛ-адреса localhost.
    </p>

    <h4>«Андроид»</h4>

    <p>Чтобы включить дополненную реальность, необходимо устройство «Андроид», поддерживающее технологию <a href="https://developers.google.com/ar/discover/supported-devices" target="_blank">ARCore</a>, и последняя версия браузера «Гугл Хром». Также необходимо установить сервисы Google Play для AR. Установка этого пакета предлагается автоматически при первом входе в режим дополненной реальности, если он уже не был установлен ранее.
    </p>

    <img src="files/ar-vr-development/google-play-services-for-ar.jpg" alt="Установка сервисов Google Play для AR" style="max-width: 720px">

    <h4>«Ай ОС» и «Айпад ОС»</h4>

    <p>
      Для «Айфонов» и «Айпадов» предусмотрено два способа запуска приложений дополненной реальности:
    </p>

    <ol>
      <li>Установить браузер *WebXR Viewer*</li>
      <li>Использовать формат USDZ для просмотра в штатном браузере «Сафари»</li>
    </ol>

    <p>
      Mozilla *WebXR Viewer* — это браузерное приложение на базе «Файрфокса», которое поддерживает технологию дополненной реальности на устройствах «Эпл» (начиная с «Айфона» модели 6s). Просто <a href="https://apps.apple.com/us/app/webxr-viewer/id1295998056" target="_blank">установите</a> его из «Апп Стор». Преимущество данного решения заключается в том, что вы можете использовать штатную технологию WebXR (и те же самые пазлы) аналогично устройствам с ОС «Андроид». Недостаток — необходимость установки ещё одного браузера (вам и вашим пользователям).
    </p>

    <p>
      С помощью формата USDZ, вы можете использовать технологию <a href="https://developer.apple.com/augmented-reality/quick-look/" target="_blank">«Эпл АР Квик Лук»</a>, которая обеспечивает упрощённый просомотр моделей в режиме дополненной реальности в браузере «Сафари». При таком подходе вам потребуется использовать совершенно другой рендер, являющийся частью операционной системы «Ай ОС», что лишает вас возможности использовать сложные материалы и определять сценарии поведения приложений с помощью пазлов.
    </p>


    [anchor:creating_ar_apps_webxr]

    <h3>Создание ДР-приложений для «Андроида» и WebXR Viewer</h3>

    <p>
      Режим ДР можно настроить для любого приложения «Вердж3Д» с помощью пазла <a href="manual/ru/puzzles/AR_VR.html#enter_ar_mode">enter AR mode</a>.
    </p>

    <img src="files/ar-vr-development/minimal-ar-puzzles.jpg" style="max-width: 819px">

    <p>
      Войдя в режим ДР, вы сможете позиционировать 3Д-контент в "реальной" системе координат, которая совмещена с вашим мобильным устройством. Кроме того, вы можете обнаруживать горизонтальные поверхности (столы, полки, пол и т.д.) с помощью ДР-пазла <a href="manual/ru/puzzles/AR_VR.html#ar_hit_test">detect horizontal surface AR</a>
    </p>

    <!-- enabling transparency for AR is a hack for WebXR Viewer -->

    <p>
      Также, чтобы увидеть реальное окружение устройства через 3Д-окно, необходимо включить опцию *transparent background* в пазле <a href="manual/ru/puzzles/Initialization.html#configure_application">configure application</a>.
    </p>

    <img src="files/ar-vr-development/transparent-background-puzzle.jpg">

    [demo:augmented_reality Дополненная реальность]


    [anchor:creating_ar_apps_usdz]

    <h3>Создание ДР-приложений на основе формата USDZ</h3>

    <p>
      Чтобы войти в режим «АР Квик Лук» вам потребуется создать USDZ-ассет. Для это вам надо будет экспортировать сцену (или отдельную модель) в процессе выполнения «Вердж3Д»-приложения (то есть на лету), либо создать данный ассет заранее в каком-нибудь пакете моделирования.
    </p>

    <h4>Подготовка USDZ-ассета в процессе выполнения</h4>

    <p>
      Этот подход основан на использовании пазла <a href="manual/ru/puzzles/Scenes.html#export_to_usdz">export to USDZ</a> используемого для генерации USDZ-ассета (смотрите пример ниже).
    </p>

    <h4>Подготовка USDZ-ассета в пакете моделирования</h4>

    <p>
      На данный момент экспорт в USDZ поддерживается в <a href="https://knowledge.autodesk.com/support/3ds-max/learn-explore/caas/CloudHelp/cloudhelp/2022/ENU/3dsMax-USD/files/GUID-04F1DF51-0079-4DF8-8457-5AD12B6C0673-html.html" target="_blank">только в «3дс Максе»</a>. Для «Блендера» вы можете попробовать неофициальный аддон <a href="https://github.com/robmcrosby/BlenderUSDZ" target="_blank">BlenderUSDZ</a>.

    <p class="note">
      USDZ отличается от более привычного USD тем, что содержит не только геометрию, но и медиа-файлы, такие как PNG, JPEG, MP3. Таким образом, пакеты моделирования, поддерживающие экспорт в формат USD, не обязательно поддерживают USDZ.
    </p>

    <p>
      Для пользователей «Мак ОС», «Ай ОС», «Айпад ОС» имеется ряд <a href="https://developer.apple.com/augmented-reality/tools/" target="_blank">утилит</a> доступных для загрузки с сайта «Эпл». С их помощью вы можете конверировать модели из форматов OBJ/FBX/glTF/USD в USDZ.
    </p>

    <h4>Загрузка USDZ</h4>

    <p>
      Чтобы просмотреть USDZ созданный заранее в пакете моделирования (или с использованием конвертера) вам нужно создать HTML-элемент в виде ссылки, содержащей изображение:
    </p>

    <code>
    &lt;a id=&quot;enter_AR_button&quot; rel=&quot;ar&quot; href=&quot;model.usdz&quot;&gt;
      &lt;img src=&quot;media/enter_AR_button.png&quot;&gt;
    &lt;/a&gt;
    </code>

    <p>
      Ссылка должна указывать на USDZ-ассет, например <em>model.usdz</em>. Изображение должно явно изображать возможность использования режима дополненной реальности, например содержать текст "Дополненая реальность". В примере выше данное изображение находится по пути <em>media/enter_AR_button.png</em> внутри директории приложения.
    </p>

    <p>
      По нажатию на такую ссылку на устройстве с «Ай ОС», система определит что имеет дело с ассетом USDZ и откроет режим «АР Квик Лук», в котором вы можете позиционировать вашу модель, словно она находится в реальном мире:
    </p>

    <img src="files/ar-vr-development/ar-quick-look.jpg" style="max-width: 310px">

    <p>
      При использовании пазлов подобная ссылка также может быть создана в процессе работы приложения:
    </p>

    <img src="files/ar-vr-development/usdz-puzzles-static.jpg">

    <p>
      Если же вы ходите создать USDZ-ассет на лету, вам потребуется следующий набор пазлов:
    </p>

    <img src="files/ar-vr-development/usdz-puzzles-dynamic.jpg">

    <p>
      Отметьте разницу — тут мы используем пазл *export to USDZ* и назначаем дополнительный атрибут *download* на ссылку.
    </p>

    [demo:augmented_reality Дополненная реальность]


    [anchor:how_to_move_in_ar_mode]

    <h3>Перемещение в дополненной реальности</h3>

    <p>
      При активации режима дополненной реальности создаётся специальная камера, привязанная к устройству. Это означает, что штатные пазлы и режимы управления камерой, назначенные в 3Д-пакетах не работают. Вместо них необходимо привязать камеру в некоему объекту (выполняющему функцию персонажа) и перемещать этот объект. Смотрите описание пазла <a href="manual/ru/puzzles/AR_VR.html#xr_camera_control_object">camera control object</a> чтобы получить больше информации.
    </p>


    [anchor:chrome_debugging]

    <h2>Отладка в «Гугл Хроме»</h2>

    <p>
      Для ускорения итераций во время разработки вы можете использовать функцию <a href="manual/ru/introduction/Testing-Mobile-Browsers.html#Port_Forwarding">port forwarding</a> браузера «Гугл Хром» для запуска вашего ВР или ДР-приложения в мобильном браузере. Это избавит вас от необходимости каждый раз заново загружать его на удаленный веб-сервер.
    </p>


    [anchor:whats_next]

    <h2>Что дальше?</h2>

    <p>
      Чтобы узнать, как написать сценарий вашего ВР/ДР-приложения с помощью пазлов, прочитайте следующий <a href="manual/ru/puzzles/AR_VR.html">раздел</a>. Также ознакомьтесь с руководством по <a href="manual/ru/introduction/Physics-Guide.html">физике</a> если вы собираетесь моделировать реалистичную виртуальную среду со столкновениями объектов и/или персонажем.
    </p>

    [demo:snowballs_vr Снежки]


    <h3>Остались вопросы?</h3>

    <p>Задайте их на нашем <a href="https://www.soft8soft.com/ru/форумы/" target="_blank">форуме</a>!</p>

  </article></body>
</html>
