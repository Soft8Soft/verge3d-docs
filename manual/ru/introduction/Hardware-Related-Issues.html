<!DOCTYPE html>
<html lang="ru">
  <head>
    <title>Проблемы связанные с аппаратным обеспечением — Софт Эйт Софт</title>
    <meta charset="utf-8">
    <meta name="description" content="Узнайте, как справиться с проблемами и ограничениями, связанными с оборудованием.">
    <base href="../../../">
    <script src="page.js"></script>
    <link type="text/css" rel="stylesheet" href="page.css">
    <style>
        table, td, th {
          border: 1px solid #2194CE;
          border-collapse: collapse;
          padding: 10px;
          text-align: left;
          min-width: 180px;
          font-size: 16px;
        }
        table {
          margin-bottom: 20px;
        }
        th {
          text-align: center;
          text-decoration: none;
          color: #0b7188;
          font-size: 17px;
          font-family: 'Oswald', sans-serif;
          font-weight: normal;
        }
        td ul {
          margin: 10px 0px;
          padding-left: 20px;
        }
        td {
          vertical-align: top;
        }
        td.centered {
          text-align: center;
        }
      </style>
  </head>
  <body><article>

    <h1>Проблемы связанные с аппаратным обеспечением</h1>

    <p>
      В этом разделе руководства описаны типичные проблемы рендеринга 3Д-графики, связанные с аппаратным обеспечением и драйверами, и которые могут возникнуть во время разработки WebGL-приложений.
    </p>

    [contents]


    [anchor:aa_issues]

    <h2>Проблемы со сглаживанием при использовании процедурных текстур</h2>

    <p>
      Иногда при использовании процедурных текстур могут возникать проблемы со сглаживанием. Например, при использовании карты Checker:
    </p>

    <img src="files/hardware-related-issues/aa_msaa.jpg">

    <p>
      Это происходит, когда в настройках экспорта *Anti-Aliasing* установлено значение *MSAA* или *Auto* (которое по умолчанию использует MSAA 4x на любом совместимом оборудовании). Техника MSAA (мультисемпловое сглаживание) обеспечивает достойное качество изображения и имеет низкое влияние на производительность, однако она не очень хорошо работает для процедурных текстур с резкими изменениями цвета объектов.
    </p>

    <p>Переключение метода *Anti-Aliasing* на *FXAA* устраняет проблему:</p>

    <img src="files/hardware-related-issues/aa_fxaa.jpg">

    <p>*FXAA* использует постобработку для уменьшения ступенчатости и хорошо работает для подобных "граней", создаваемых процедурными картами.</p>


    [anchor:z_fighting]

    <h2>Артефакты пересечения, когда два объекта расположены близко друг к другу</h2>

    <p>
      Иногда вы можете столкнуться с артефактами, подобными этим:
    </p>

    <img src="files/hardware-related-issues/z-fighting.jpg" alt="Артефакты z-файтинга">

    <p>
      Это так называемый *z-fighting* (<a href="https://ru.wikipedia.org/wiki/Z-%D0%B1%D1%83%D1%84%D0%B5%D1%80%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F" target="_blank">техническая документация на «Википедии»</a>) и происходит он, когда разные полигоны имеют равную дистанцию до камеры, или их дистанция отличается очень незначительно.
    </p>

    <p>
      Чтобы исправить это, вам нужно сделать одно из следующих действий:
    </p>

    <ul>
      <li>Самое простое решение - расположить объекты дальше друг от друга.</li>
      <li>Увеличьте дистанцию <em>near</em> (или <em>clip start</em>) камеры и/или уменьшите дистанцию <em>far</em> (или <em>clip end</em>) камеры. Это сделает диапазон расстояний камеры меньше и тем самым повысит точность значений, хранящихся в буфере глубины.</li>
      <li>Если вам нужно разместить текстуру билборда над какой-либо поверхностью — отключите *Depth Test* на материале билборда и увеличьте параметр *Rendering Order* на объекте. Билборд будет отображаться после объекта поверхности и будет игнорировать глубину, сохраненную этим объектом. Это эффективно устраняет z-fighting, который может произойти между этими двумя объектами.</li>
    </ul>


    [anchor:banding_artifacts]

    <h2>Артефакты-полосы при использовании градиентов или тёмных сцен</h2>

    <p>При использовании градиентов и затемнённых сцен возможно возникновение следующих артефактов в виде полос:</p>

    <img src="files/hardware-related-issues/dithering_off.jpg" alt="Рендеринг без дитеринга">

    <p>
      Эти артефакты вызваны ограничением точности цветовых буферов и могут быть устранены (или существенно уменьшены) посредством использования <a href="https://ru.wikipedia.org/wiki/%D0%94%D0%B8%D0%B7%D0%B5%D1%80%D0%B8%D0%BD%D0%B3" target="_blank">дитеринга</a>:
    </p>

    <img src="files/hardware-related-issues/dithering_on.jpg" alt="Рендеринг с включённым дитерингом">

    <p>
      Инструкции по включению дитеринга находятся в соответствующих разделах: <a href="manual/ru/blender/Lighting-and-Rendering.html#material_verge3d_panel">«Блендер»</a>, <a href="manual/ru/max/Materials-Maps-Reference.html#Physical">«3дс Макс»</a>, or <a href="manual/ru/maya/Materials.html#standardSurface">«Майя»</a>.
    </p>


    [anchor:too_many_attributes]

    <h2>Слишком много атрибутов</h2>

    <p>
      Время от времени при работе над сценой вы можете столкнуться с проблемой, когда некоторые объекты не отрисовываются вообще, а в консоли браузера появляется следующая ошибка:
    </p>

    <figure style="max-width: 846px">
      <img src="files/hardware-related-issues/too-many-attributes.jpg" alt="Browser console">
      <figcaption>Ошибка "Too many attributes" в консоли браузера</figcaption>
    </figure>

    <p>
      Эта ошибка означает, что некоторые объекты (очевидно те, которые не смогли быть отрисованы) превышают максимальное количество вертексов, которые могут быть использовать в одном шейдере.
    </p>

    <p>
      То, сколько атрибутов использует объект, зависит от различных факторов: наличие и количество shape keys (Блендер) / morph targets (3дс Макс) / blend shapes (Майя), наличие скиннинга, определенных нод материалов и т.д.
    </p>

    <p>
      Вот таблица, которая объясняет, как рассчитать количество используемых атрибутов:
    </p>

    <table>
      <thead>
        <tr>
          <th>Число атрибутов</th>
          <th>Описание</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>3</td>
          <td>Обязательные атрибуты: <b>position</b>, <b>normal</b>, <b>uv</b>.</td>
        </tr>
        <tr>
          <td>+2x (WebGL 1.0)</td>
          <td>
            <p>
              Добавляется за каждый shape key («Блендер») / morph target («3дс Макс») / blend shape target («Майя»). Максимальное количество атрибутов для для этой категории ограничено <b>+12</b>.
            </p>
            <p>
              Для современного оборудования, поддерживающего стандарт WebGL 2.0, морфинг не требует атрибутов.
            </p>
          </td>
        </tr>
        <tr>
            <td>+2</td>
            <td>Добавляется если объект использует скиннинг</td>
        </tr>
        <tr>
          <td>+1x</td>
          <td>
            Добавьте для каждой из следующих нод материала объекта, которые используют различные<a href="manual/ru/introduction/Hardware-Related-Issues.html#attribute-table0">*</a> вертексные цвета:
            <ul>
              <li>«Блендер»: <b>Attribute</b>, <b>Vertex Color</b></li>
            </ul>
          </td>
        </tr>
        <tr>
            <td>+1x</td>
            <td>
              Добавьте для каждой из следующих нод материала объекта, которые используют различные<a href="manual/ru/introduction/Hardware-Related-Issues.html#attribute-table0">*</a> карты нормалей кроме первой (она уже покрыта обязательным атрибутом uv, см. первую строку):
              <ul>
                <li>«Блендер»: <b>UV Map</b></li>
                <li>«3дс Макс»: <b>Bitmap</b> (только если "Mapping Type" выставлен на "Texture") <b>Gradient Ramp</b>, <b>Noise</b> (только если "Mapping" выставлен на "Explicit Map Channel")</li>
                <li>«Майя»: <b>place2dTexture</b></li>
              </ul>
          </td>
        </tr>
        <tr>
            <td>+1</td>
            <td>
                Добавьте, если материал объекта имеет одну из следующих нод:
                <ul>
                  <li>«Блендер»: <b>Normal Map</b>, <b>Tangent</b> (только в режиме "UV Map")</li>
                  <li>«3дс Макс»: <b>Normal Bump</b></li>
                  <li>«Майя»: <b>aiNormalMap</b>, <b>bump2d</b> (только во вход "Bump Interp" > 0), <b>samplerInfo</b></li>
                </ul>
            </td>
        </tr>
        <tr>
            <td>+1</td>
            <td>
              Добавьте, если материал объекта имеет одну из следующих нод:
              <ul>
                <li>«3дс Макс»: <b>Vertex Color</b></li>
              </ul>
            </td>
        </tr>
      </tbody>
    </table>

    <p id="attribute-table0" style="font-size: 14px;">
      * Если несколько узлов используют один и тот же вертексный цвет или карту нормалей, то все эти ноды считаются как одна.
    </p>

    <p>
      Как правило, достаточно оставаться в пределах <b>16</b> вертексных атрибутов (хотя некоторые старые/низкокачественные устройства могут поддерживать только 8). Чаще всего вам следует беспокоиться только об объектах, использующих несколько ключей формы. В остальном количество вертексных атрибутов обычно не превышает лимит для типичного объекта/материала.
    </p>


    <h2>Остались вопросы?</h2>

    <p>Задайте их на нашем <a href="https://www.soft8soft.com/ru/форумы/" target="_blank">форуме</a>!</p>

  </article></body>
</html>
