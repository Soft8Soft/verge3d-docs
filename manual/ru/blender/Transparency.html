<!DOCTYPE html>
<html lang="ru">
  <head>
    <title>Вердж3Д для Блендера: Прозрачность — Софт Эйт Софт</title>
    <meta charset="utf-8">
    <meta name="description" content="Узнайте, какие виды прозрачности можно включить для материалов Блендера и использовать в Вердж3Д.">
    <base href="../../../">
    <script src="page.js"></script>
    <link type="text/css" rel="stylesheet" href="page.css">
  </head>
  <body><article>

    <h1>Прозрачность / Блендер</h1>

    <p>
      В этой статье мы покажем вам, как включать прозрачность для «Иви»/«Сайклз», а также glTF-совместимых материалов в «Блендере».
    </p>

    [contents]


    [anchor:setting_up_in_blender]

    <h2>Настройка в «Блендере»</h2>

    <p>
      Прозрачность для материалов «Иви» может быть включена с помощью комбинации шейдерных нод *Transparent BSDF* и *Mix Shader*. Параметр фактора ноды *Mix Shader* определяет уровень прозрачности — вы можете назначить его напрямую, либо воспользоваться выходом какой-нибудь другой ноды, например *Fresnel*, позволяющей повысить реалистичность прозрачности.
    </p>

    <img src="files/transparency-blender/transparent-bsdf.webp">

    <p>В качестве альтернативы вы можете использовать вход *Alpha* ноды Principled BSDF node.</p>

    <img src="files/transparency-blender/principled-bsdf-alpha.webp">

    <p>Используйте выпадающий список *Blend Mode*, чтобы выбрать необходимый режим прозрачности:</p>

    <dl>
      <dt>Auto</dt>
      <dd>Проанализировать материал и выбрать один из двух методов: *Opaque* (непрозрачный) или *Alpha Blend* (альфа-блендинг).</dd>
      <dt>Opaque</dt>
      <dd>Не использовать прозрачность.</dd>
      <dt>Alpha Clip</dt>
      <dd>Прозрачность в виде маски (альфа-клиппинг) (см. <a href="manual/ru/blender/Transparency.html#blended_vs_masked">ниже</a>).</dd>
      <dt>Alpha Hashed</dt>
      <dd>Хеш-прозрачность, или прозрачность частичного перекрытия. Этот метод является промежуточным между клиппингом и блендингом. По сути это разширение метода маски, использующее мульти-самплинг.</dd>
      <dt>Alpha Blend</dt>
      <dd>Альфа-блендинг (см. <a href="manual/ru/blender/Transparency.html#blended_vs_masked">ниже</a>).</dd>
    </dl>

    <p>
      Для настройки прозрачности имеется ряд дополнительных свойств, расположенных на панели *Verge3D Settings*:
    </p>

    <img src="files/transparency-blender/material-settings.webp" style="max-width: 328px">

    <dl>
      <dt>Clip Threshold</dt>
      <dd>Порог для альфа клиппинга. Если в процессе рендеринга значение альфа-канала материала окажется ниже этого порога, поверхность в этом месте не будет отображаться.</dd>
      <dt>Transparency Hack</dt>
      <dd>
        Включить один из двух специализированных режимов для борьбы с артефактами прозрачности:
        <dl>
          <dt>Nearest Layer</dt>
          <dd>Рендерить только ближайший к камере слой с помощью вспомогательного буфера глубины (техника "depth prepass").</dd>
          <dt>Two-Pass</dt>
          <dd>Рендерить сначала обратную сторону объектов, а потом прямую. Техника работает только для двусторонних материалов (опция *Render Side* должна быть установлена в *Double-sided*).</dd>
        </dl>
        Обе техники уменьшают производительность, поэтому используйте их только когда это реально необходимо.
      </dd>
    </dl>

    [demo:transparency Прозрачность]


    [anchor:blended_vs_masked]

    <h2>Альфа-блендинг и альфа-клиппинг</h2>

    <p>
      «Вердж3Д», являясь 3Д-движком, работающим в реальном времени, предлагает два метода работы с прозрачными объектами: альфа-блендинг и альфа-клиппинг (обычно с изображением-маской). Альфа-блендинг позволяет комбинировать полупрозрачный цвет переднего плана с цветом фона, используя альфа-канал в качестве фактора смешивания. Альфа-клиппинг действует по принципу отбрасывания всех пикселей альфа-канала меньше заданного порога (по умолчанию 0, но может быть изменено в настройках материала).
    </p>

    <img src="files/transparency-common/blending-vs-clipping.jpg">

    <p>
      Альфа-блендинг менее производителен, чем альфа-клиппинг, но обеспечивает мягкие переходы, которые выглядят красивее. Альфа-блендинг также может вызывать артефакты связанные с Z-файтингом, когда полигоны визуализируются в неправильном порядке. Альфа-клиппинг создает жёсткие края, которые не могут быть сглажены, поэтому лучше всего подходит для визуализации многочисленных небольших предметов (таких как трава или листья деревьев).
    </p>


    [anchor:alpha_add]

    <h2>Аддитивный композитинг (рендеринг без буфера глубины)</h2>

    <p>
      «Вердж3Д» также предлагает специальный режим для отключения буфера глубины во время рендеринга. Это приводит к отмене сравнения значений глубины пикселей перекрываемых полигонов. Такие полигоны будут визуализированы аддитивным способом, который иногда позволяет избавиться от артефактов альфа-смешения.
    </p>

    <img src="files/transparency-common/no-depth-writes.jpg">

    <p>
      Чтобы включить данный режим, используйте следующий материал. Замените ноду *Glossy BSDF* на ноду которая требуется в вашем материале.
    </p>

    <img src="files/transparency-blender/additive-blending-nodes.jpg">

    <p>
      Также отключите опцию *Depth Write* расположенную в окне настроек *Verge3D Settings*.</p>
    </p>

    <img src="files/transparency-blender/depth-write.jpg" style="max-width: 294px;">


    [anchor:rendering_order]

    <h2>Порядок рендеринга (Z-индекс)</h2>

    <p>
      «Вердж3Д» не выполняет сортировку полигонов внутри объектов, но сортирует объекты по дальности. В большинстве случаев это приводит к правильному смешиванию, но иногда может потребоваться принудительно изменить порядок отображения объектов.
    </p>

    <p>
      Чтобы изменить порядок рендеринга для определённого объекта, установите числовой параметр *Render Order* панели настроек «Вердж3Д». Чем меньше индекс объекта, тем раньше он будет отрисован.
    </p>

    <img src="files/transparency-blender/rendering-order.jpg" alt="Парметр Render Order в Блендере" style="max-width: 326px">

    <p>
      Поэтому, если требуется, чтобы прозрачные объекты на фоне которых в сцене присутствует другой объект, отображались корректно, установите любое отрицательное значение для объекта расположенного сзади.
    </p>

    <img src="files/transparency-common/rendering-order-example.jpg" alt="Пример сцены с изменённым порядком рендеринга">


    [anchor:oit_rendering]

    <h2>Порядконезависимая прозрачность (OIT)</h2>

    <p>
      «Вердж3Д» позволяет использовать метод приближенной порядконезависимой прозрачности, который не требует рендеринга геометрии в отсортированном порядке, поэтому он избавляет от большинства артефактов альфа-смешения, без использования вышеперечисленных приёмов.
    </p>

    <img src="files/transparency-common/oit-example.jpg">

    <p>
      Данную опцию можно активировать в панели настроек <a href="manual/ru/blender/Lighting-and-Rendering.html#global_rendering_properties_verge3d">Verge3D Settings</a>.
    </p>

    <img src="files/transparency-blender/oit.jpg" alt="Настройки Order-Independent Transparency в Блендере" style="max-width: 449px;">

    <p>Ограничения:</p>

    <ul>
      <li>
        OIT опция совместима только с WebGL 2, в противном случае эффекта не будет.
      </li>
      <li>
        OIT игнорируется зондами освещения <a href="manual/ru/blender/Lighting-and-Rendering.html#light_probes">в виде отражающих кубических текстур</a> и <a href="manual/ru/blender/Lighting-and-Rendering.html#reflection_plane_light_probes">в виде планарных отражений</a>.
      </li>
      <li>
        Может плохо работать с объектами с малой прозрачностью.
      </li>
      <li>
        Не следует использовать вместе с *MSAA* (мультисемпловое сглаживание) в сценах с 2 и более непрозрачными объектами. Вместо этого вы можете использовать *FXAA* (быстрое приближенное сглаживание), которое полностью совместимо с OIT.
      </li>
    </ul>


    [anchor:transparency_gltf]

    <h2>Прозрачность для glTF-совместимых материалов</h2>

    <p>
      Чтобы обеспечить прозрачность для таких материалов, добавьте альфа-маску в альфа-канал текстуры базового цвета. Также вы можете настроить альфа-канал, используя <strong>Alpha</strong> вход в ноде Principled BSDF.
    </p>

    <img src="files/transparency-blender/gltf-PBR-ztransparency.jpg" alt="Прозрачные glTF-материалы">

    <p>
      Используйте выпадающий список <strong>Blend Mode</strong>, чтобы выбрать необходимый режим прозрачности.
    </p>


    <h2>Остались вопросы?</h2>

    <p>Задайте их на нашем <a href="https://www.soft8soft.com/ru/форумы/" target="_blank">форуме</a>!</p>

  </article></body>
</html>
