<!DOCTYPE html>
<html lang="ru">
  <head>
    <title>Анимациионная система Вердж3Д — Софт Эйт Софт</title>
    <meta charset="utf-8">
    <meta name="description" content="Как анимировать сцену Вердж3Д с помощью Ява Скрипта.">
    <base href="../../../">
    <script src="page.js"></script>
    <link type="text/css" rel="stylesheet" href="page.css">
  </head>
  <body><article>
    <h1>Анимационная система «Вердж3Д»</h1>

    <h2>Обзор</h2>

    <p>
      Анимационная система «Вердж3Д» позволяет анимировать различные сущности: кости [page:SkinnedMesh ригов], ключи морфинга, свойства материалов (цвет, прозрачность, бинарные операции), видимость и трансформацию объектов. Анимированные свойства могут быть затухающими, перекрестными или искажёнными. Вес и временные шкалы различных анимаций могут быть изменены независимо друг от друга. Различные анимации на одном и том же или на разных объектах могут быть синхронизированы между собой.
    </p>

    <p>
      На этой странице вы можете ознакомиться с основными компонентами анимационной системы, а также узнать как они взаимодейстуют между собой.
    </p>

    <h3>Анимационные клипы</h3>

    <p>
      Если вы успешно загрузили анимированный 3Д-объект, в частности, экспортированный из «Блендера», «3дс Макса» или «Майи» с помощью [page:GLTFLoader], одним из полей загруженного объекта будет "animations", содержащий массив [page:AnimationClip AnimationClip]-ов для данного ассета.
    </p>
    <p>
      Каждый *AnimationClip* обычно содержит данные для определенного действия объекта. Например, если меш является персонажем, AnimationClip может содержать анимацию ходьбы. Если же меш является конфигурируемым объектом, в нём может содержатся анимация цвета материала.
    </p>
    <p class="note">
      «Вердж3Д» не поддерживает несколько анимаций одного типа для одних и тех же объектов. Например, если у персонажа имеются анимации для ходьбы, ожидания и бега, все они должны располагаться на одной временной шкале.
    </p>

    <h3>Треки ключевых кадров</h3>

    <p>
      Внутри *AnimationClip*-ов данные для каждого анимированного свойства хранятся в отдельном [page:KeyframeTrack]-е. Предположим, что объект персонажа имеет связанный с ним [page:Skeleton скелет]. В таком случае, одна дорожка ключевых кадров может хранить данные об изменении положения кости нижней части руки со временем, другая дорожка - данные об изменении вращения той же кости, третья — данные о положении, вращении или масштабировании другой кости, и так далее. Следует понимать, что AnimationClip может состоять из множества таких дорожек.
    </p>
    <p>
      Предположим, что модель имеет [page:Geometry.morphTargets морфинг] (например, один морф таргет показывает дружелюбное лицо, а другой - сердитое). В таком случае каждая дорожка содержит информацию о том, как меняется [page:Mesh.morphTargetInfluences влияние] определенного морф таргета во время исполнения клипа.
    </p>

    <h3>Микшер анимации</h3>

    <p>
      Сохраненные данные составляют лишь основу для анимации - фактическое воспроизведение контролируется [page:AnimationMixer]-ом. Вы можете представить его не только как плеер для анимаций, но и как имитацию настоящего микшерного пульта, который может управлять несколькими анимациями одновременно, смешивая и объединяя их.
    </p>

    <h3>Анимационные действия</h3>

    <p>
      Сам *AnimationMixer* имеет очень мало (общих) свойств и методов, поскольку им можно управлять с помощью [page:AnimationAction AnimationAction]-а. Настроив *AnimationAction*, вы можете определить, когда определенный *AnimationClip* должен быть воспроизведен или остановлен на одном из микшеров, будет ли и как часто клип должен повторяться, должен ли он выполняться с затуханием или масштабированием времени, и некоторые дополнительные вещи, такие как кроссфейдинг или синхронизация.
    </p>

    <h3>Анимация группы объектов</h3>

    <p>
      Если вы хотите, чтобы группа объектов имела общую анимацию, вы можете использовать объект класса [page:AnimationObjectGroup].
    </p>

    <h2>Пример</h2>

    <code>
    let mesh;

    // создаём AnimationMixer и получаем экземпляры AnimationClip-ов
    const mixer = new v3d.AnimationMixer(mesh);
    const clips = mesh.animations;

    // обновляем микшер каждый кадр
    function update() {
        mixer.update(deltaSeconds);
    }

    // запускаем конкретную анимацию
    const clip = v3d.AnimationClip.findByName(clips, 'dance');
    const action = mixer.clipAction(clip);
    action.play();

    // запускаем все анимации
    clips.forEach(function(clip) {
        mixer.clipAction(clip).play();
    });
    </code>


    <h2>Пазлы</h2>

    <p>
      «Вердж3Д» содержит несколько <a href="manual/ru/puzzles/Animation.html">анимационных пазлов</a>, которые скрывают сложность системы анимации. В этих пазлах используется простая концепция «анимационных объектов», которые можно выбрать из списка или назвать по имени. Добавляя визуальные блоки, можно воспроизводить/приостанавливать/остановить/клонировать/разделять/подключать эти объекты без написания кода.
    </p>

    <img src="files/api/animation-puzzles-example.webp">


  </article></body>
</html>
