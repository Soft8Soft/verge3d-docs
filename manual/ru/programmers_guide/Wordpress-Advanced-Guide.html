<!DOCTYPE html>
<html lang="ru">
  <head>
    <title>Расширенное руководство по использованию Вордпресса — Софт Эйт Софт</title>
    <meta charset="utf-8">
    <meta name="description" content="Как отправлять заказы и формы в фоне и настроить Вордпресс-плагин Вердж3Д с помощью Ява Скрипта.">
    <base href="../../../">
    <script src="page.js"></script>
    <link type="text/css" rel="stylesheet" href="page.css">
  </head>
  <body><article>
    <h1>Расширенное руководство по использованию «Вордпресса»</h1>

    <p>
      Этот раздел содержит расширенное руководство по работе с «Вордпрессом». В частности, рассмотрены вопросы фоновой отправки заказов и форм, модификации плагина, а также приведена спецификация на протокол электронной коммерции, используемый в плагине. Если вам необходима информация об основах работы с «Вордпрессом», читайте раздел <a href="manual/ru/introduction/Wordpress-Plugin.html">Плагин для Вордпресса</a> руководства пользователя.
    </p>

    <h2>Содержание</h2>

    [contents]


    [anchor:receiving_orders_rest_api]

    <h2>Получение заказов в фоне с использованием REST API</h2>

    <p>В ряде случаев вы можете использовать свой собственный интерфейс для отправки заказов, вместо перенаправления покупателей на страницу заказа.</p>

    <p>Допустим в качестве примера, что стоит задача сделать конфигуратор столов. В этом случае отправляемые данные могут иметь вид:</p>

    <code>
    {
        "user_name": "Иван Петров",
        "user_email": "иван.петров@пример.рф",
        "user_phone": "+123456789"
        "items": [
            {
                "sku": "table_top_white",
                "quantity": 1
            },
            {
                "sku": "table_leg_brown",
                "quantity": 4
            },
        ]
    }</code>

    <p>
      Существует два способа создания заказов, основанных на приведённых данных:
    </p>

    <ol>
      <li>С помощью ПОСТ-запросов и данных в формате FormData (версия v1)</li>
      <li>С помощью ПОСТ-запросов и данных в формате JSON (версия v2)</li>
    </ol>


    [anchor:place_order_form_data]

    <h3>Отправка форм с помощью FormData</h3>

    <p>
      Для отпавки, создайте HTML-форму с полями, указанными выше и отправьте эту форму с помощью пазла <a href="manual/ru/puzzles/Advanced.html#send_data">send data</a> на следующий адрес:
    </p>

    <code class="language-html">https://ВП_ХОСТ/wp-json/verge3d/v1/place_order/</code>

    <p>Где ВП_ХОСТ это имя хоста «Вордпресс»-сервера, например <em>sandbox.soft8soft.com</em></p>

    <p>
      С помощью пазлов, поля формы, требующие ввода данных пользователем (напр. "user_name", "user_email", "user_phone") могут быть созданы следующим образом:
    </p>

    <img src="files/wordpress-advanced/order-form-text-inputs.webp">

    <p>
      Тогда как поля с артикулами товара (SKU) делаются с помощью скрытых полей формы:
    </p>

    <img src="files/wordpress-advanced/order-form-hidden-inputs.webp">

    <p>
      Форма отправляется без перезагрузки страницы следующим образом:
    </p>

    <img src="files/wordpress-advanced/order-form-submit.webp">


    [anchor:place_order_json]

    <h3>Отправка форм с помощью JSON</h3>

    <p>
      Вы можете сформировать структуру данных в виде объекта «Ява Скрипта» и затем отправить её с помощью метода этого языка, называемого fetch(), однако с помощью <a href="manual/ru/puzzles/Dictionaries.html">словаря</a> и пазла <a href="manual/ru/puzzles/Advanced.html#send_data">send data</a> сделать это намного проще.
    </p>

    <p>УРЛ-адрес для отправки в JSON-формате следующий:</p>

    <code class="language-html">https://ВП_ХОСТ/wp-json/verge3d/v2/place_order/</code>

    <p>Где ВП_ХОСТ это имя хоста «Вордпресс»-сервера, например <em>sandbox.soft8soft.com</em></p>

    <p>
      В частности, пазлы для создания данного типа запросов могут иметь вид:
    </p>

    <img src="files/wordpress-advanced/order-json-submit.webp">

    <p>
      В примере используется пазл <a href="manual/ru/puzzles/ECommerce.html#order_item">order item</a> из вкладки E-Commerce, что позволяет существенно ускорить заполнение элементов заказа.
    </p>


    [anchor:sending_forms]

    <h2>Отправка форм на почту</h2>

    <p>
      «Вердж3Д для Вордпресса» предоставляет возможность оправки любых HTML-форм на адрес, выбранный в интерфейсе администрирования плагина. Таким образом, в частности, вы можете получать вопросы от потенциальных клиентов, сообщения для службы поддержки, предзаказы, контакты пользователей и т.д.
    </p>

    <p>УРЛ-адрес для отправки форм на почту имеет вид:</p>

    <code class="language-html">https://ВП_ХОСТ/wp-json/verge3d/v1/send_form/</code>

    <p>Где ВП_ХОСТ это имя хоста «Вордпресс»-сервера, например <em>sandbox.soft8soft.com</em></p>

    <p>
      Сама форма может быть реализована с помощью HTML/CSS, пазлов или визуального редактора, на подобие «Вебфлоу». Смотрите <a href="manual/ru/introduction/HTML-based-user-interfaces.html">как создавать HTML-интерфейсы</a> в соответствующем разделе документации. Кроме того, форма может быть отправлена напрямую, с помощью кнопки «Отправить» или косвенно, с помощью пазлов или «Ява Скрипта» (чтобы не перезагружать страницу).
    </p>

    <p>
      Если вы используете пазлы, вы можете воспользоваться следующей конструкцией для отправки формы без перезагрузки (создание самой формы не показано):
    </p>

    <img src="files/wordpress-advanced/send-form-custom.webp">

    <p>
      Библиотека пазлов <a href="manual/ru/puzzles/Library.html#inquiry_form">Inquiry Form</a> содержит готовый пример, который можно использовать в качестве основы собственного приложения.
    </p>

    <img src="files/puzzles/puzzles-library-inquiry-form-look.webp">


    [anchor:customizing_ecommerce_forms]

    <h2>Настройка форм электронной коммерции</h2>

    <p>Для изменения форм e-commerce скопируйте шаблоны форм, расположенные в каталоге <em>templates</em> плагина «Вердж3Д», в каталог вашей темы «Вордпресс», в подкаталог <em>verge3d</em>.</p>

    <p>Например, если вам нужно изменить шаблон электронной почты заказа:</p>

    <code class="language-html">КОРЕНЬ/wp-content/plugins/verge3d/templates/order_email_body.php → ТЕМА/verge3d</code>

    <p>Где КОРЕНЬ — это корневой каталог вашей установки «Вордпресса», а ТЕМА — каталог вашей текущей темы.</p>

    <p>Вот список шаблонов, которые вы можете настроить:</p>

    <table>
      <tr>
        <th>Файл шаблона</th>
        <th>Описание</th>
      </tr>
      <tr>
        <td>order_email_body.php</td>
        <td>Шаблон тела письма с заказом. Этот шаблон используется как для уведомлений о заказах, отправляемых вам, так и вашим клиентам.</td>
      </td>
      <tr>
        <td>order_pdf.php</td>
        <td>Шаблон с PDF-вложением к электронному письму с заказом. Этот шаблон используется для создания HTML-файлов, которые будут преобразованы в PDF и прикреплены к электронным письмам с заказами.</td>
      </td>
      <tr>
        <td>order_form.php</td>
        <td>Шаблон формы заказа. Эта форма отображается для ваших клиентов на страницах, где присутствует код <strong>[verge3d_order]</strong>.</td>
      </td>
      <tr>
        <td>order_success.php</td>
        <td>Сообщение, отображаемое при принятии заказа.</td>
      </tr>
      <tr>
        <td>order_failed.php</td>
        <td>Сообщение, отображаемое при отклонении заказа.</td>
      </td>
      <tr>
        <td>payment_paypal.php</td>
        <td>Страница обработки заказа в платёжной системе «Пейпал».</td>
      </tr>
      <tr>
        <td>send_form_email_body.php</td>
        <td>Шаблон писем, сформированных для заказов, отправленных с помощью REST API.</td>
      </tr>
    </table>

    <h3>Меры безопасности</h3>

    <p>
      При использовании пользовательских форм в приложениях e-commerce не забудьте правильно экранировать выходные данные, отправляемые клиентами. Для получения дополнительной информации воспользуйтесь следующим <a href="https://developer.wordpress.org/apis/security/escaping/" target="_blank">руководством</a> (англ.).
    </p>


    [anchor:ecommerce_protocol_specification]

    <h2>Спецификация на протокол электронной коммерции</h2>

    <p>Пазлы <strong>place order</strong> и <strong>place order +</strong> используют следующий протокол для обработки заказов. Заказы отправляются из браузера на сервер с помощью HTTP POST-запросов со следующими параметрами:</p>

    <table>
      <tr>
        <th>POST-параметр</th>
        <th>Описание</th>
      </tr>
      <tr>
        <td>v3d_items</td>
        <td>Пункты заказа. Массив со структурами, закодированный в формате JSON</td>
      </tr>
      <tr>
        <td>v3d_attachments[]</td>
        <td>Опциональные вложения заказа. Массив ссылок в формате [link:manual/ru/puzzles/HTML.html#data_url Data URL].
      </tr>
    </table>

    <p>
      Пункт заказа имеет конфигурацию, зависящую от используемого пазла. Для <strong>place order</strong> она имеет вид:
    </p>

    <table>
      <tr>
        <th>Поле</th>
        <th>Описание</th>
      </tr>
      <tr>
        <td>title</td>
        <td>Название пункта заказа.</td>
      </tr>
      <tr>
        <td>price</td>
        <td>Цена пункта заказа.</td>
      </tr>
      <tr>
        <td>quantity</td>
        <td>Количество товара в пункте: число, вес, длина, и т.д.</td>
      </tr>
    </table>

    <p>
      Для пазла <strong>place order +</strong>:
    </p>

    <table>
      <tr>
        <th>Поле</th>
        <th>Описание</th>
      </tr>
      <tr>
        <td>sku</td>
        <td>Артикул товара. Этот артикул используется как идентификатор чтобы получить информацию о продукте с сервера.</td>
      </tr>
      <tr>
        <td>quantity</td>
        <td>Количество товара в пункте: число, вес, длина, и т.д.</td>
      </tr>
    </table>

    <p>Более продвинутый протокол на основе JSON использует следующий набор параметров по умолчанию:</p>

    <table>
      <tr>
        <th>Поле JSON</th>
        <th>Описание</th>
      </tr>
      <tr>
        <td>user_name</td>
        <td>Полное имя клиента (также используется как имя владельца карты).</td>
      </tr>
      <tr>
        <td>user_email</td>
        <td>Электронная почта клиента.</td>
      </tr>
      <tr>
        <td>user_phone</td>
        <td>Телефон клиента.</td>
      </tr>
      <tr>
        <td>user_comment</td>
        <td>Комментарии к заказу.</td>
      </tr>
      <tr>
        <td>items</td>
        <td>Массив с пунктами заказа.</td>
      </tr>
      <tr>
        <td>attachments</td>
        <td>Вложения. Опциональный массив со ссылками [link:manual/ru/puzzles/HTML.html#data_url Data URL], содержащими вложения заказа.
      </tr>
      <tr>
        <td>user_address1</td>
        <td>Первая строка адреса владельца карты. Чтобы использовать это поле, активируйте опцию *Billing address* на вкладке *General* настроек плагина.</td>
      </tr>
      <tr>
        <td>user_address2</td>
        <td>Вторая строка адреса владельца карты. Чтобы использовать это поле, активируйте опцию *Billing address* на вкладке *General* настроек плагина.</td>
      </tr>
      <tr>
        <td>user_city</td>
        <td>Город владельца карты. Чтобы использовать это поле, активируйте опцию *Billing address* на вкладке *General* настроек плагина.</td>
      </tr>
      <tr>
        <td>user_state</td>
        <td>Регион владельца карты. Чтобы использовать это поле, активируйте опцию *Billing address* на вкладке *General* настроек плагина.</td>
      </tr>
      <tr>
        <td>user_country</td>
        <td>Страна владельца карты. Чтобы использовать это поле, активируйте опцию *Billing address* на вкладке *General* настроек плагина.</td>
      </tr>
      <tr>
        <td>user_postcode</td>
        <td>Почтовый индекс владельца карты. Чтобы использовать это поле, активируйте опцию *Billing address* на вкладке *General* настроек плагина.</td>
      </tr>
      <tr>
        <td>shipping_address1</td>
        <td>Первая строка адреса доставки. Чтобы использовать это поле, активируйте опцию *Shipping address* на вкладке *General* настроек плагина.</td>
      </tr>
      <tr>
        <td>shipping_address2</td>
        <td>Вторая строка адреса доставки. Чтобы использовать это поле, активируйте опцию *Shipping address* на вкладке *General* настроек плагина.</td>
      </tr>
      <tr>
        <td>shipping_city</td>
        <td>Город доставки. Чтобы использовать это поле, активируйте опцию *Shipping address* на вкладке *General* настроек плагина.</td>
      </tr>
      <tr>
        <td>shipping_state</td>
        <td>Регион доставки. Чтобы использовать это поле, активируйте опцию *Shipping address* на вкладке *General* настроек плагина.</td>
      </tr>
      <tr>
        <td>shipping_country</td>
        <td>Страна доставки. Чтобы использовать это поле, активируйте опцию *Shipping address* на вкладке *General* настроек плагина.</td>
      </tr>
      <tr>
        <td>shipping_postcode</td>
        <td>Индекс доставки. Чтобы использовать это поле, активируйте опцию *Shipping address* на вкладке *General* настроек плагина.</td>
      </tr>
    </table>


    <h2>Остались вопросы?</h2>

    <p>Задавайте их на нашем <a href="https://www.soft8soft.com/ru/форумы/" target="_blank">форуме</a>!</p>


  </article></body>
</html>
