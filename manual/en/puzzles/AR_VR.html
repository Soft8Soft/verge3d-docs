<!DOCTYPE html>
<html lang="en">
  <head>
    <title>AR/VR Puzzles Reference — Soft8Soft</title>
    <meta charset="utf-8">
    <meta name="description" content="How to enable and use the augmented reality and virtual reality modes in Puzzles.">
    <base href="../../../">
    <script src="page.js"></script>
    <link type="text/css" rel="stylesheet" href="page.css">
  </head>
  <body><article>

    <h1>AR/VR Puzzles</h1>

    <p>
      These puzzles are used to enable web-based Augmented Reality (AR) and Virtual Reality (VR) experiences running on top of the browser technology called WebXR (eXtended Reality on the Web).
    </p>

    <img src="files/puzzles/puzzles-ar-vr.jpg" alt="AR/VR visual programming blocks">

    <p>
      For more information with regard to supported AR/VR devices and best practices see the <a href="manual/en/introduction/AR-VR-development.html">corresponding topic</a> of this User Manual.
    </p>


    <h2>Contents</h2>

    [contents]


    [anchor:puzzles_reference]

    <h2>Puzzles Reference</h2>

    [anchor:check_vr_mode]

    <h3>check VR mode</h3>

    <p>
      Checks the virtual reality system. If successful, the puzzles in the *if available do* are triggered. Otherwise, if the browser does not support VR or VR hardware not found, the puzzles in the *if unavailable do* slot are triggered.
    </p>

    <img src="files/puzzles/puzzles-ar-vr-check-vr-mode.jpg" alt="Visual programming block to check if the system supports VR hardware">

    <p>
      See the following <a href="manual/en/introduction/AR-VR-development.html#virtual_reality">section</a> for more info on creating virtual reality applications with Verge3D.
    </p>


    [anchor:enter_vr_mode]

    <h3>enter VR mode</h3>

    <p>
      Enters the virtual reality mode. Puzzles placed in the *on enter do* and *on exit do* slots are triggered upon entering or exiting the VR mode. Puzzles placed in the *if unavailable do* are triggered if a VR session could not be established.
    </p>

    <img src="files/puzzles/puzzles-ar-vr-enter-vr-mode.jpg" alt="Visual programming block to enter VR mode">

    <p>VR positioning modes:</p>

    <dl>
      <dt>
        sitting or standing
      </dt>
      <dd>
        Immobile camera positioned at some height above the ground. The center of the world coordinate space located just under the user's feet. This mode is recommended because it's compatible with the most popular VR headsets available on the market such as Meta Quest 1-3, HTC Vive, etc.
      </dd>
      <dt>
        looking around
      </dt>
      <dd>
        Immobile camera positioned at zero coordinates.
      </dd>
      <dt>
        room
      </dt>
      <dd>
        Mobile camera located inside some bounds such as room.
      </dd>
      <dt>
        walking
      </dt>
      <dd>
        Mobile unbounded camera.
      </dd>
      <dt>
        viewer locked
      </dt>
      <dd>
        Immobile camera positioned at zero coordinates. All content is parented to the view.
      </dd>
    </dl>

    <p>
      In order to properly control the camera in VR mode, be sure to snap and parent it to some empty/dummy or real object, positioned in the 3D editor of your choice, upon entering the VR mode. This is needed because the VR session has the full control over your camera, and you can move only the empty/dummy object to which the camera is parented.
    </p>

    <img src="files/puzzles/puzzles-ar-vr-enter-vr-mode-example.jpg" alt="Example script used to enter VR mode">

    <p>
      Starting from Verge3D 4.3 you can use <a href="manual/en/puzzles/AR_VR.html#xr_camera_control_object">camera control object</a> puzzle instead of creating a control object by hand.
    </p>


    [anchor:check_ar_mode]

    <h3>check AR mode</h3>

    <p>
      Checks the augmented reality system (WebXR). If successful, the puzzles in the *if available do* slot are triggered. Otherwise, if the browser does not support AR or AR hardware not found, the puzzles in the *else if unavailable do* slot are triggered. The puzzles in the *else if Apple USDZ do* slot are triggered when no WebXR-compatible hardware found, but the system supports USDZ-based Apple AR Quick Look technology.
    </p>

    <img src="files/puzzles/puzzles-ar-vr-check-ar-mode.jpg" alt="Visual programming block to check if the system supports AR mode">

    <p>
      See the following <a href="manual/en/introduction/AR-VR-development.html#augmented_reality">section</a> for more info on creating augmented reality applications with Verge3D.
    </p>


    [anchor:enter_ar_mode]

    <h3>enter AR mode</h3>

    <p>
      Enters the augmented reality mode. Puzzles placed in the *on enter do* and *on exit do* slots are triggered upon entering or exiting the AR mode. Puzzles placed in the *if unavailable do* are triggered if a AR session could not be established.
    </p>

    <p>
      Property *allow HTML* is used to display HTML content in AR mode. If specified, the content of the <em>canvas container</em> element will be rendered above 3D content. This option is considered experimental.
    </p>

    <p>AR positioning modes:</p>

    <dl>
      <dt>
        looking around
      </dt>
      <dd>
        Immobile camera positioned at zero coordinates. This mode is recommended for typical AR use cases, e.g for positioning a model on some horizontal or vertical surface.
      </dd>
      <dt>
        sitting or standing
      </dt>
      <dd>
        Immobile camera positioned at some height above the ground. The center of the world coordinate space located just under the user's feet.
      </dd>
      <dt>
        room
      </dt>
      <dd>
        Mobile camera located inside some bounds such as room.
      </dd>
      <dt>
        walking
      </dt>
      <dd>
        Mobile unbounded camera.
      </dd>
      <dt>
        viewer locked
      </dt>
      <dd>
        Immobile camera positioned at zero coordinates. All content is parented to the view.
      </dd>
    </dl>

    <img src="files/puzzles/puzzles-ar-vr-enter-ar-mode.jpg" alt="Visual programming block to enter AR mode">


    [anchor:ar_hit_test]

    <h3>detect surface AR</h3>

    <p>
      Detect surfaces in AR mode by casting a ray forward. Upon intersection, this ray will trigger puzzles in *on intersection do* slot. If no intersection occurred or the device is in warming-up state the puzzles triggers *if missed do* slot.
    </p>

    <p>
      Parameter *smooth* is used to make AR marker movement smoother. Specify value 0 to disable smoothing, value close to 1 for maximum smoothing.
    </p>

    <img src="files/puzzles/puzzles-ar-vr-ar-hit-test.jpg" alt="Visual logic block to detect surfaces in AR mode">


    [anchor:ar_hit_point]

    <h3>AR hit point</h3>

    <p>
      Surface point coordinate(s) detected by the <a href="manual/en/puzzles/AR_VR.html#ar_hit_test">detect surface AR</a> puzzle. Can be *X*, *Y*, *Z* value, or *XYZ* vector.
    </p>

    <img src="files/puzzles/puzzles-ar-vr-ar-hit-point.jpg" alt="Block to retrieve coordinates of hit point in AR mode">


    [anchor:ar_hit_normal]

    <h3>AR hit normal</h3>

    <p>
      Surface normal vector detected by the <a href="manual/en/puzzles/AR_VR.html#ar_hit_test">detect surface AR</a> puzzle. Can be *X*, *Y*, *Z* value, or *XYZ* vector.
    </p>

    <img src="files/puzzles/puzzles-ar-vr-ar-hit-normal.jpg" alt="Block to retrieve normal of hit point in AR mode">


    [anchor:xr_camera_control_object]

    <h3>camera control object</h3>

    <p>
      Get camera control object. By offsetting this object (e.g. with the <a href="manual/en/puzzles/Objects.html#set_transform">set transform</a> puzzle), you can efficiently move the camera in the AR or VR mode. This spares you from the need to maintain some empty object specifically to parent and snap the camera to, as this object is created or dropped automatically when entering or exiting WebXR.
    </p>

    <img src="files/puzzles/puzzles-ar-vr-xr-camera-control-object.jpg" alt="Visual block to retrieve camera control object in AR/VR mode">


    [anchor:session_event]

    <h3>on session event</h3>

    <p>
      Captures a VR session event generated by a VR device (e.g. a headset or controller button) and triggers puzzles specified in the *do* slot.
    </p>

    <img src="files/puzzles/puzzles-ar-vr-on-session-event.jpg" alt="Visual logic script to capture WebXR events">

    <p>Events:</p>

    <ul>
      <li>*select* — triggered when user pressed and released the primary controller button.</li>
      <li>*selectstart* — triggered when user pressed the primary controller button.</li>
      <li>*selectend* — triggered when user released the primary controller button.</li>
      <li>*squeeze* — triggered when user squeezed and released a controller.</li>
      <li>*squeezestart* — triggered when user squeezed a controller.</li>
      <li>*squeezeend* — triggered when user unsqueezed controller.</li>
      <li>*connected* — triggered when VR controller connected, i.e. upon entering a VR session. Use this event to initialize any controller logic.</li>
      <li>*disconnected* — triggered when VR controller disconnected.</li>
    </ul>


    [anchor:traverse_controllers]

    <h3>traverse controllers</h3>

    <p>
      Loop over all connected VR controllers, execute puzzles specified in the *do* slot.
    </p>

    <img src="files/puzzles/puzzles-ar-vr-traverse-controllers.jpg" alt="Visual programming block to traverse VR controllers" style="max-width: 825px">


    [anchor:get_controller_prop]

    <h3>get controller property</h3>

    <p>
      Get the controller property.
    </p>

    <img src="files/puzzles/puzzles-ar-vr-get-controller-prop.jpg" alt="Visual programming block to query VR controllers" style="max-width: 819px">

    <p>Properties:</p>

    <ul>
      <li>*object* — an empty object representing controller.</li>
      <li>*ray/reticle* — controller ray or reticle object.</li>
      <li>*handedness* — controller handedness, one of: "left" (left controller), "right" (right controller), "none" (unspecified, likely head-mounted controller).</li>
      <li>*target ray mode* — one of: "gaze" (for gaze aka cardboard-like devices), "tracked-pointer" (for regular handheld controllers), "screen" (the event is associated with canvas input, currently not implemented).</li>
      <li>*profiles* — a list of controller profile names.</li>
      <li>*gamepad index* — a controller gamepad index which can be passed to the <a href="manual/en/puzzles/System.html#get_gamepad_prop">get gamepad property</a> puzzle to retrieve more info from your controller, such as the status of buttons/axes.</li>
    </ul>


    [anchor:end_vr_session]

    <h3>end AR/VR session</h3>

    <p>
      Ends a virtual reality or augmented reality session.
    </p>

    <img src="files/puzzles/puzzles-ar-vr-end-ar-vr-session.jpg" alt="Visual block to end AR/VR session">


    <h2>Having Troubles with Puzzles?</h2>

    <p>Seek help on the <a href="https://www.soft8soft.com/forums/" target="_blank">forums</a>!</p>

  </article></body>
</html>
